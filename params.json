{"name":"Focus Lab's EE Master Config","body":"## Introduction\r\n\r\nAt Focus Lab we work in multiple environments for every ExpressionEngine site we build. (For the sake of simplicity we'll just define an environment as \"any server running an instance of your site.\") In order for ExpressionEngine to support quick and easy deployments across environments, you need to use a robust config file. This is our approach to doing just that. A big strength in this approach is that we can ignore our local environment config file from Git. That way each local developer has their own config overrides that won't affect the main repository.\r\n\r\nThe folder structure for a given project is the following:\r\n\r\n~~~\r\n/config\r\n   - config.{env}.php\r\n   - config.env.php\r\n   - config.master.php\r\n/public_html\r\n/system\r\n~~~\r\n\r\nWhere `{env}` is a shorthand hand for our environment. We typically have 4 environments. Production, Staging, Shared development & Local development. That in mind, our files are:\r\n\r\n~~~\r\nconfig.dev.php\r\nconfig.env.php\r\nconfig.local.php\r\nconfig.master.php\r\nconfig.prod.php\r\nconfig.stage.php\r\n~~~\r\n\r\n\r\n## Concept\r\n\r\nThere are three primary pieces to this structure. Environment declaration, master config values & environment-specific config values.\r\n\r\n\r\n### Environment Declaration\r\n\r\nThis file is the starting point of your environment setup. Based on the `HTTP_HOST` variable in PHP we define the environment (this may change if you're using a load balance environment or EE's MSM module). This is handled in the `config.env.php` file.\r\n\r\nWe approach the environment from the top down. We define all environments based on the domain and then set our default to \"local\" which allows our local developers to use whatever domain they choose (eg: mysite.dev, mysite.local, etc).\r\n\r\nThree constants are defined in our environment declaration file. They are:\r\n\r\n- `ENV`\r\n- `ENV_FULL`\r\n- `ENV_DEBUG`\r\n\r\n#### `ENV`\r\n\r\nThis is the short-hand name of your environment. It needs to directly reflect the naming convention of your environment-specific file (seen below) such as `config.local.php`. This value is used as a conditional occasionally in the master config file.\r\n\r\n#### `ENV_FULL`\r\n\r\nThis is the full name of your environment. There are no requirements on this value. We simply use it in our templates from time to time (\"You are currently in the _Staging_ environment\").\r\n\r\n#### `ENV_DEBUG`\r\n\r\nThis is our boolean debug flag used frequently in our master config file. It allows us to keep debug settings \"on\" in specific environments. You can see how this is used in the master config file.\r\n\r\n### Master Config file\r\n\r\nOur `config.master.php` file contains the bulk of the data for our setup. These are default configuration settings for our EE projects. Here we break up config settings into logical groups and add/remove as needed per project. In plain English, this is what the `config.master.php` document does/says:\r\n\r\n~~~\r\nIf EE is looking for database credentials\r\n\tLoad our environment-specific file (eg: config.prod.php)\r\n\tDefine our DB cache directory\r\n\tMerge our expressionengine/config/database.php array with our environment-specific db array\r\n\tUnset our environment-specific array now that it's been used as needed\r\nEnd if\r\n\r\nIf EE is looking for config array values\r\n\tDefine our base paths (as inspired by Matt Weinberg)\r\n\tDefine our template config settings\r\n\tDefine our Debug settings\r\n\tDefine our Performance-impacting settings\r\n\tDefine any 3rd party settings\r\n\tDefine any member-specific settings\r\n\tDefine some final, miscellaneous settings\r\n\tLoad our environment-specific config file (eg: config.prod.php)\r\n\tSetup some global variables for template use: {global:env} and {global:env_full}\r\n\tMerge our Global Variables arrays then our Config arrays\r\nEnd if\r\n~~~\r\n\r\n#### Override Options\r\n\r\nYou can find a list of available configuration override options here on the EE Wiki page [EE 2 Config Overrides](http://expressionengine.com/wiki/EE_2_Config_Overrides). You can alternatively find individual setting array keys by \"inspecting\" elements within EE's Control Panel and taking note of the input names. Third party developers may also include config override support in their add-ons.\r\n\r\n#### Templates Settings\r\n\r\nYou can now change the location of your templates directory. Find `$env_config['tmpl_file_basepath']` around line `132` in the `config.master.php` and change the value as needed.\r\n\r\n#### Global Variables\r\n\r\nYou can define a set of template global variables in the `config.master.php` file as well. Around line `232` you will see that there are 2 variables available as an example. You can add anything here that you prefer, such as default date format strings etc.\r\n\r\n\r\n### Environment-Specific Config\r\n\r\nThe final piece to the equation is the environment-specific file. This file include the database credentials and any desired config overrides or global variables. This is the simplest and shortest of the three files.\r\n\r\nThere are three possible arrays to use here. They are `$env_db`, `env_config` and `$env_global`.\r\n\r\n#### `$env_db`\r\n\r\nThis is just for your database credentials for the environment. **What makes this convenient is that we ignore our `config.local.php` file from Git.** That way each local developer has their own config overrides that won't affect the main repository.\r\n\r\n~~~\r\n$env_db['hostname'] = '';\r\n$env_db['username'] = '';\r\n$env_db['password'] = '';\r\n$env_db['database'] = '';\r\n~~~\r\n\r\n#### `$env_config`\r\n\r\nThis array allows you to override any config value from EE or from the master config file. This is useful for changing things that may be unique to a test environment. A good example would be the **webmaster_email** setting. If a single developer wants to receive all system emails to themselves when developing locally, they might use the following:\r\n\r\n\t$env_config['webmaster_email'] = 'me`domain.com';\r\n\r\n#### `$env_global`\r\n\r\nThis array is for defining global variables available within your EE templates. An example of how this can be used is the idea of using Google Analytics (GA) to track stats on your site. In the past we've used GA for tracking Staging and Production environments separately. Doing this was simple because we could define the GA key per-environment as needed.\r\n\r\n\t$env_global['global:google_analytics'] = 'UA-XXXXXXX-XX';\r\n\r\nThis gives you variables like `{global:google_analytics}` in your EE templates.\r\n\r\n\r\n## Setup\r\n\r\n- Copy the `/config` directory to the same directory level as your `system` directory [we recommend \"above web root\"](http://expressionengine.com/user_guide/installation/best_practices.html#moving-the-system-directory-above-webroot))\r\n- Modify `config.env.php` to reflect your environments and domains. You can remove and add environments as needed\r\n- Update each `config.{env}.php` file with each environment's database credentials as needed\r\n- Create config overrides and global variables for each environment as needed\r\n- Add the following code to the bottom of `system/expressionengine/config/config.php` (be sure not to delete other config settings already in this file):\r\n\r\n~~~\r\n/**\r\n * Require the Focus Lab, LLC Master Config file\r\n */\r\nrequire $_SERVER['DOCUMENT_ROOT'] . '/../config/config.master.php';\r\n\r\n\r\n/* End of file config.php */\r\n/* Location: ./system/expressionengine/config/config.php */\r\n~~~\r\n\r\n- Replace the contents of your `system/expressionengine/config/database.php` file with the contents in of the same file in this repository\r\n\r\n\r\n## Contributions\r\n\r\nIf you're interested in making this better please feel free to [fork](http://help.github.com/fork-a-repo/) the code [on GitHub](https://github.com/focuslabllc/ee-master-config) and send [pull requests](http://help.github.com/send-pull-requests/). Also, we'd love to track any potential issues through the repository's [Issues tracker](https://github.com/focuslabllc/ee-master-config/issues).\r\n\r\n\r\n## Support\r\n\r\nWe are happy to answer questions as needed and able, but there is no official support for using this config setup. Use it at your own risk with the understanding that our responses to any inquires will fall behind any commitments we may have at the time.\r\n\r\n**We are also available for private consultation if you would like assistance getting this setup for your EE site.**\r\n\r\n<dev@focuslabllc.com>\r\n\r\n\r\n## Legal\r\n\r\n### Disclaimer Of Warranty\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESSED OR IMPLIED, INCLUDING, BUT NOT LIMITED TO, WARRANTIES OF QUALITY, PERFORMANCE, NON-INFRINGEMENT, MERCHANTABILITY, OR FITNESS FOR A PARTICULAR PURPOSE.\r\n\r\n### Limitations Of Liability\r\n\r\nYOU ASSUME ALL RISK ASSOCIATED WITH THE INSTALLATION AND USE OF THE SOFTWARE. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS OF THE SOFTWARE BE LIABLE FOR CLAIMS, DAMAGES OR OTHER LIABILITY ARISING FROM, OUT OF, OR IN CONNECTION WITH THE SOFTWARE. LICENSE HOLDERS ARE SOLELY RESPONSIBLE FOR DETERMINING THE APPROPRIATENESS OF USE AND ASSUME ALL RISKS ASSOCIATED WITH ITS USE, INCLUDING BUT NOT LIMITED TO THE RISKS OF PROGRAM ERRORS, DAMAGE TO EQUIPMENT, LOSS OF DATA OR SOFTWARE PROGRAMS, OR UNAVAILABILITY OR INTERRUPTION OF OPERATIONS.","tagline":"Focus Lab's Master Config setup for quick ExpressionEngine multi-environment support","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}